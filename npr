# /bin/sh

set -eu
: $1

BRANCH_NAME=$1

LAST_BRANCH_NAME=`git rev-parse --abbrev-ref @`
echo "last branch: [ ${LAST_BRANCH_NAME} ]"

git fetch --all
git checkout master
git pull

if [ $LAST_BRANCH_NAME = "deployment/development_2nd" -o $LAST_BRANCH_NAME = "master"  -o $LAST_BRANCH_NAME = "deployment/qa"  -o $LAST_BRANCH_NAME = "deployment/production" ]; then
  echo "Skip delete: target is ${LAST_BRANCH_NAME}"
else
  echo "Delete branch: ${LAST_BRANCH_NAME}"
  git branch -D ${LAST_BRANCH_NAME}
fi

git checkout -b ${BRANCH_NAME}
git commit --allow-empty -m "NOPR: squash me [ci skip]"
git push -f -u
hub pull-request
